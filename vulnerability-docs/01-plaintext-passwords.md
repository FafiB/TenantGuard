# Vulnerability: Plaintext Password Storage

## 1. Vulnerability Name
**CWE-256: Unprotected Storage of Credentials**

## 2. Location in Code
- **File:** `backend/src/models/User.js` (lines 15-16)
- **File:** `backend/src/routes/auth.js` (lines 25-26, 45-46)

```javascript
// User.js - Password stored as plain text
password: {
    type: String,
    required: true
}

// auth.js - Direct password comparison
if (user.password !== password) {
    return res.status(401).json({ message: 'Invalid credentials' });
}
```

## 3. Technical Root Cause
The application stores user passwords in plaintext format in the MongoDB database without any hashing or encryption. Password verification is performed through direct string comparison rather than secure hash comparison.

## 4. Proof of Concept Explanation
1. Register a new user with password "mypassword123"
2. Access the MongoDB database directly
3. Query the users collection to view stored passwords
4. Observe that passwords are stored in readable plaintext format

## 5. Exploit Script

```python
#!/usr/bin/env python3
import requests
import json

def exploit_plaintext_passwords():
    base_url = "http://localhost:5000"
    
    # Register test user
    register_data = {
        "name": "Test User",
        "email": "testuser@example.com",
        "password": "secretpassword123",
        "tenantId": "tenant1"
    }
    
    print("[+] Registering user with password: secretpassword123")
    response = requests.post(f"{base_url}/api/auth/register", json=register_data)
    
    if response.status_code == 201:
        print("[+] User registered successfully")
        
        # Login to get token
        login_data = {
            "email": "testuser@example.com",
            "password": "secretpassword123"
        }
        
        login_response = requests.post(f"{base_url}/api/auth/login", json=login_data)
        
        if login_response.status_code == 200:
            print("[+] Login successful - passwords stored in plaintext")
            print("[!] VULNERABILITY CONFIRMED: Passwords are not hashed")
            return True
    
    return False

if __name__ == "__main__":
    exploit_plaintext_passwords()
```

## 6. Impact
- **Confidentiality:** Complete compromise of user credentials
- **Authentication Bypass:** Attackers with database access can impersonate any user
- **Compliance Violation:** Violates data protection regulations (GDPR, PCI-DSS)
- **Lateral Movement:** Credential reuse enables access to other systems

**CVSS Score:** 9.1 (Critical)

## 7. Fix Recommendation

Replace plaintext storage with bcrypt hashing:

```javascript
// User.js - Add password hashing
const bcrypt = require('bcrypt');

userSchema.pre('save', async function(next) {
    if (!this.isModified('password')) return next();
    this.password = await bcrypt.hash(this.password, 12);
    next();
});

userSchema.methods.comparePassword = async function(candidatePassword) {
    return await bcrypt.compare(candidatePassword, this.password);
};

// auth.js - Use secure comparison
const isValidPassword = await user.comparePassword(password);
if (!isValidPassword) {
    return res.status(401).json({ message: 'Invalid credentials' });
}
```